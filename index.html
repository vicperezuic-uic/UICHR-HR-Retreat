<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UIC Song Quiz</title>
<style>
  body { font-family:'Segoe UI', sans-serif; background:#f4f6f9; margin:0; padding:20px; }
  img { width:150px; position:absolute; top:20px; left:20px; }
  .quiz-container { max-width:900px; margin:0 auto; background:white; padding:20px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
  .question { margin-bottom:20px; }
  input[type=text] { width:100%; padding:8px; margin:5px 0; border-radius:6px; border:1px solid #ccc; }
  label { display:block; margin:4px 0; }
  button { background:#d50032; color:white; border:none; padding:12px 20px; border-radius:8px; cursor:pointer; font-size:16px; }
  button:hover { background:#a00025; }
</style>
</head>
<body>
<img src="https://www.uic.edu/sites/default/files/styles/uic-logo/public/uic-logo.png" alt="UIC Logo">
<div class="quiz-container">
  <h1>UIC Song Quiz</h1>
  <form id="quizForm"></form>
  <button id="submitBtn">Submit Quiz</button>
</div>

<script src="questions.js"></script>
<script>
const currentUser = localStorage.getItem("currentUser");

// ✅ Redirect to start if no email
if(!currentUser){
    alert("Please enter your email first.");
    window.location.href = "start.html";
}

// ✅ Ensure questions.js loaded
if(!questions || questions.length === 0){
    alert("Quiz questions failed to load. Make sure questions.js is in the same folder as index.html.");
}

// ✅ Populate quiz after page loads
window.onload = function() {
    const form = document.getElementById("quizForm");
    
    questions.forEach((q,i)=>{
        const div = document.createElement("div");
        div.className = "question";
        div.innerHTML = `
            <h3>Q${i+1} - Song Name</h3>
            <input type="text" id="song-${i}" maxlength="250" placeholder="Enter song name">
            <h4>Requested By</h4>
            ${q.choices.map(c=>`<label><input type="radio" name="requester-${i}" value="${c}"> ${c}</label>`).join('')}
        `;
        form.appendChild(div);
    });
};

// ✅ Handle submission
document.getElementById("submitBtn").addEventListener("click", function(){
    const submissions = JSON.parse(localStorage.getItem("quizSubmissions") || "{}");

    if(submissions[currentUser]){
        alert("You have already submitted.");
        return;
    }

    let score=0;
    const userAnswers=[];

    questions.forEach((q,i)=>{
        const songAnswer = document.getElementById(`song-${i}`).value.trim();
        const radios = document.getElementsByName(`requester-${i}`);
        let requesterAnswer = "";
        for(let r of radios){
            if(r.checked) requesterAnswer=r.value;
        }
        userAnswers.push({songAnswer, requesterAnswer});
        if(songAnswer.toLowerCase() === q.correctSong.toLowerCase()) score++;
        if(requesterAnswer === q.correctRequester) score++;
    });

    submissions[currentUser] = {
        score,
        submittedAt: new Date().toISOString(),
        answers: userAnswers
    };
    localStorage.setItem("quizSubmissions", JSON.stringify(submissions));

    alert("Submission recorded!");
    window.location.href = "start.html";
});
</script>
</body>
</html>
